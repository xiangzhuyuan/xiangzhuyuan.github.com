---
layout: post
title: nyroModal的使用方法
date: 2010-08-31 10:15
comments: true
categories: []
---
<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:53a98528-a432-481b-ac76-53e70f984d3b" class="wlWriterEditableSmartContent">Technorati 标签: <a href="http://technorati.com/tags/nyroModal+jquery" rel="tag">nyroModal jquery</a></div>  <h4>Usage</h4>  <p>The plugin provide some function to work with it:</p>  <ul>   <li><em>nyroModal();</em> is the basic function to set the click or submit function. To add the nyroModal functionnality to all links containing in #container, you'll do:       <pre>$('#container a').nyroModal();</pre>
Pretty long, right? As all jQuery plugin, the chain is not broken. That mean you can use it like all other jQuery functions. You can also set the settings as an object paramter to overwrite the default parameter. </li>

  <li><em>nyroModalManual();</em> will execute the same action like a click in a real link. You can simulate an user click or create your modal content. <a href="http://nyromodal.nyrodev.com/#demos">See demos</a> to better understand. </li>

  <li><em>$.nyroModalSettings(settings);</em> could be used to change the default settings if no modal are started or the current settings if a modal is currently shown. For example, it will be pretty useful to change the modal size or background color from an Ajax request. If you call this function with the width, height, and/or bgColor parameters while the modal is already shown, the related animation function will be called. </li>

  <li><em>$.nyroModalRemove();</em> will simply remove the modal. Could be useful if you need to close after a time or something else. </li>
</ul>

<p>When using the gallery modal, you can also use these functions:</p>

<ul>
  <li><em>$.nyroModalNext();</em> Go to the next image. Return the link which opened the image if successful or false if nothing was done </li>

  <li><em>$.nyroModalPrev();</em> Go to the previous image. Return the link which opened the image if successful or false if nothing was done </li>
</ul>

<p>When you open a modal using an Ajax request, the scripts included in the loaded page are executed folowing these rules:</p>

<ul>
  <li>If the modal is a targeting content, only the scripts inside this element are executed </li>

  <li>If the modal isn't targeting: 
    <ul>
      <li>All the inline script are executed </li>

      <li>The scripts with a src attribute to load a javascript file are loaded only if they are the attribute <em>rel="forceLoad"</em>. This avoid the reload of jQuery for example </li>
    </ul>
  </li>
</ul>

<p>If you need to investigate what's going on with your modal, you could enable the debug. But sometimes, it's not enough and you want more. You could overwrite the function <em>nyroModalDebug(msg, elts, settings);</em> to do what ever you want!</p>

<h4>Settings</h4>

<p>You have 3 different ways to modify the settings:</p>

<ol>
  <li>Directly modify <em>$.fn.nyroModal.settings</em>. These settings will be used by default for every modal which will be open </li>

  <li>Set at first parameter to the <em>nyroModal();</em> function. Example: 

    <pre>$('a.nyroModal').nyroModal({bgColor: '#ffffff'});</pre>
  </li>

  <li>Use the <em>$.nyroModalSettings(settings);</em> function </li>
</ol>

<p>Here is the complete usable settings list, with their default values.</p>

<pre>$.fn.nyroModal.settings = {
  debug: false, // Show the debug in the background
  blocker: false, // Element which will be blocked by the modal
  windowResize: true, // indicates if the modal should resize when the window is resized
  modal: false, // Esc key or click backgrdound enabling or not
  type: '', // nyroModal type (form, formData, iframe, image, etc...)
  forceType: null, // Used to force the type
  from: '', // Dom object where the call come from
  hash: '', // Eventual hash in the url
  processHandler: null, // Handler just before the real process
  selIndicator: 'nyroModalSel', // Value added when a form or Ajax is sent with a filter content
  formIndicator: 'nyroModal', // Value added when a form is sent
  content: null, // Raw content if type content is used
  bgColor: '#000000', // Background color
  ajax: {}, // Ajax option (url, data, type, success will be overwritten for a form, url and success only for an ajax call)
  swf: { // Swf player options if swf type is used.
    wmode: 'transparent'
  },
  width: null, // default Width If null, will be calculate automatically
  height: null, // default Height If null, will be calculate automatically
  minWidth: 400, // Minimum width
  minHeight: 300, // Minimum height
  resizable: true, // Indicate if the content is resizable. Will be set to false for swf
  autoSizable: true, // Indicate if the content is auto sizable. If not, the min size will be used
  padding: 20, // padding for the max modal size
  regexImg: '[^\.]\.(jpg|jpeg|png|tiff|gif|bmp)\s*$', // Regex to find images
  addImageDivTitle: false, // Indicate if the div title should be inserted
  defaultImgAlt: 'Image', // Default alt attribute for the images
  setWidthImgTitle: true, // Set the width to the image title
  ltr: true, // Right to left by default. Put to false for Hebrew or Left to Right language
  gallery: null, // Gallery name if provided
  galleryLinks: '<a href="#" class="nyroModalPrev">Prev</a><a href="#"  class="nyroModalNext">Next</a>', // Use .nyroModalPrev and .nyroModalNext to set the navigation link
  galleryCounts: galleryCounts, // Callback to show the gallery count
  galleryLoop: false, // Indicate if the gallery should loop
  zIndexStart: 100,
  cssOpt: { // Default CSS option for the nyroModal Div. Some will be overwritten or updated when using IE6
    bg: {
      position: 'absolute',
      overflow: 'hidden',
      top: 0,
      left: 0,
      height: '100%',
      width: '100%'
    },
    wrapper: {
      position: 'absolute',
      top: '50%',
      left: '50%'
    },
    wrapper2: {
    },
    content: {
    },
    loading: {
      position: 'absolute',
      top: '50%',
      left: '50%',
      marginTop: '-50px',
      marginLeft: '-50px'
    }
  },
  wrap: { // Wrapper div used to style the modal regarding the content type
    div: '<div class="wrapper"></div>',
    ajax: '<div class="wrapper"></div>',
    form: '<div class="wrapper"></div>',
    formData: '<div class="wrapper"></div>',
    image: '<div class="wrapperImg"></div>',
    swf: '<div class="wrapperSwf"></div>',
    iframe: '<div class="wrapperIframe"></div>',
	iframeForm: '<div class="wrapperIframe"></div>',
    manual: '<div class="wrapper"></div>'
  },
  closeButton: '<a href="#" class="nyroModalClose" id="closeBut" title="close">Close</a>', // Adding automaticly as the first child of #nyroModalWrapper 
  title: null, // Modal title
  titleFromIframe: true, // When using iframe in the same domain, try to get the title from it
  openSelector: '.nyroModal', // selector for open a new modal. will be used to parse automaticly at page loading
  closeSelector: '.nyroModalClose', // selector to close the modal
  contentLoading: '<a href="#" class="nyroModalClose">Cancel</a>', // Loading div content
  errorClass: 'error', // CSS Error class added to the loading div in case of error
  contentError: 'The requested content cannot be loaded.<br />Please try again later.<br /><a href="#" class="nyroModalClose">Close</a>', // Content placed in the loading div in case of error
  handleError: null, // Callback in case of error
  showBackground: showBackground, // Show background animation function
  hideBackground: hideBackground, // Hide background animation function
  endFillContent: null, // Will be called after filling and wraping the content, before parsing closeSelector and openSelector and showing the content
  showContent: showContent, // Show content animation function
  endShowContent: null, // Will be called once the content is shown
  beforeHideContent: null, // Will be called just before the modal closing
  hideContent: hideContent, // Hide content animation function
  showTransition: showTransition, // Show the transition animation (a modal is already shown and a new one is requested)
  hideTransition: hideTransition, // Hide the transition animation to show the content
  showLoading: showLoading, // show loading animation function
  hideLoading: hideLoading, // hide loading animation function
  resize: resize, // Resize animation function
  endResize: null, // Will be called one the content is resized
  updateBgColor: updateBgColor, // Change background color animation function
  endRemove: null // Will be called once the modal is totally gone
};</pre>

<h4>Callbacks</h4>

<p>As an effort to be as more flexible as possible, the plugin provide many callbacks that you can use to alter the data at different time in the process. To be more clear, here is the full process with all possible callback:</p>

<ol>
  <li>The User click on the link or you write some code to open the modal </li>

  <li><em>processHandler(settings);</em>: Use this callback to change the type, the height requested, etc... </li>

  <li>If it's a new modal: 
    <ol>
      <li><em>showBackground(elts, settings, callback);</em>: elts.bg should be visible after it </li>

      <li><em>showLoading(elts, settings, callback);</em>: elts.loading should be visible after it </li>

      <li><em>handleError(elts, settings);</em>: will be calling in case of error, just before showing the error message </li>

      <li><em>hideLoading(elts, settings, callback);</em>: elts.loading should be hidden after it </li>

      <li>If there is an ajax or a form call, the eventual Javascript code inside it will be called at this time </li>

      <li><em>endFillContent(elts, settings);</em>: modal.content is already wrapped. The links to open or close are not binded. This could be a could be good place to alter the content, the size, add some close link </li>

      <li><em>showContent(elts, settings, callback);</em>: modal.contentWrapper should be visible after it </li>
    </ol>
Or if the modal already exist (call from a modal, navigation inside the gallery): 

    <ol>
      <li><em>showTransition(elts, settings, callback);</em>: elts.loading should be visible after it and elts.contentWrapper should be hidden </li>

      <li>If there is an ajax or a form call, the eventual Javascript code inside it will be called at this time </li>

      <li><em>handleError(elts, settings);</em>: will be calling in case of error, just before showing the error message </li>

      <li><em>endFillContent(elts, settings);</em>: modal.content is already wrapped. The links to open or close are not binded. This could be a could be good place to alter the content, the size, add some close link </li>

      <li><em>hideTransition(elts, settings, callback);</em>: elts.loading should be hidden after it and elts.contentWrapper should be shown </li>
    </ol>
  </li>

  <li><em>endShowContent(elts, settings);</em>: The modal is now fully visible. Here is a place to add more visual elements which could have some issues in some browser </li>

  <li>The User enjoy the modal. One day, he will probably close the modal or click somewhere to open a new modal </li>

  <li>You have the ability to resize the modal by using <em>$.nyroModalSettings</em> with width and/or height parameters. In this case: 

    <ol>
      <li><em>resize(elts, settings, callback);</em>: elts.contentWrapper should be at the new dimensions after it </li>

      <li><em>endResize(elts, settings);</em>: will be called once the resize is done </li>
    </ol>
It's also possible to update the background color by using <em>$.nyroModalSettings</em> again with the bgColor parameter: 

    <ol>
      <li><em>updateBgColor(elts, settings, callback);</em>: elts.bg should be shown with the new color. To animate the color, be sure to include <a href="http://plugins.jquery.com/project/color">the color plugin</a>. </li>
    </ol>
  </li>

  <li><em>beforeHideContent(elts, settings, callback);</em>: called just before the removing modal. use this to remove element that could create trouble with the hiding animation </li>

  <li><em>hideContent(elts, settings, callback);</em>: modal.contentWrapper should be hidden after it </li>

  <li>If a new modal is requested, go back to the 2nd step. If not, we're closing the modal and continue </li>

  <li><em>hideBackground(elts, settings, callback);</em>: modal.bg should be hidden after it </li>

  <li>Everything created by the plugin will be removed </li>

  <li><em>endRemove(elts, settings);</em>: will be called once the modal is totally gone. Elements in the elts object will be unusable </li>
</ol>

<p>The object <em>elts</em> will contain these parameters:</p>

<ul>
  <li><em>started</em>: indicate if the modal is started </li>

  <li><em>ready</em>: indicate if the modal is ready </li>

  <li><em>dataReady</em>: indicate if the data are ready </li>

  <li><em>anim</em>: indicate if the modal is currently animated </li>

  <li><em>animContent</em>: indicate if the modal content is currently animated </li>

  <li><em>loadingShown</em>: indicate if the loading is currently shown </li>

  <li><em>transition</em>: indicate if the transtion is currently shown </li>

  <li><em>closing</em>: indicate if the modal is closing </li>

  <li><em>error</em>: indicate if there is an error in the data loading </li>

  <li><em>blocker</em>: the blocker element if existing </li>

  <li><em>blockerVars</em>: blocker variables used to position the modal elements </li>

  <li><em>full</em>: jQuery object for the full nyroModal div container </li>

  <li><em>bg</em>: jQuery object for the background div </li>

  <li><em>loading</em>: jQuery object for the loading div </li>

  <li><em>tmp</em>: jQuery object for the temporary div </li>

  <li><em>content</em>: jQuery object for the content div </li>

  <li><em>wrapper</em>: jQuery object for the wrapper div (inserted between content and contentWrapper) </li>

  <li><em>contentWrapper</em>: jQuery object for the content wrapper div </li>
</ul>

<p>To read more about the animation callback, see below.</p>

<h4>Animation Callbacks</h4>

<p>You can redefine the animation as you want. To do so, you'll rewrite completly the animation function. That mean you can whatever you want. If you want simply show the element without any animation, you can simply do an <em>show</em> in the element and execute the callback. That's it.</p>

<p>To be more convenient, all animation callback function takes the exact same parameters:</p>

<ol>
  <li><em>elts</em>: will be used to access to the elements. To be sure to be totally free to do what you want as you want, you can access all element. You're free to break everything if you like to! See previous chapter to know what's inside </li>

  <li><em>settings</em>: contains the whole currentsettings object. You have to use some elements inside this object to be sure to do something working good </li>

  <li><em>callback</em>: don't forget to execute this one! If you don't, the modal will be broken. You can call it by passing it to the <em>complete</em> attribute for the animation, or simply do something like: <em>callback();</em></li>
</ol>

<p>The best way to start an animation function is probably to copy/paste his content from the plugin, see how it works and what is doing and then start edit it.</p>

<p>When positionning the loading or the content, you'll probably center it. To do so we usually use this king of CSS:</p>

<pre>#element {
  position: fixed;
  width: 500px;
  height: 300px;
  margin-left: -250px; // -width / 2
  margin-top: -150px; // -height / 2
}</pre>

<p>And it should works. But you probably know that IE6 doesn't understand the position fixed. That's why you have to use <em>settings.marginScrollTop</em> and <em>settings.marginScrollLeft</em> to be sure your element is well centered. These values will be equal to zero in the convenient browser, and equal to the scroll values in IE6. When showing the content, 2 others values are available to set the margin: <em>settings.marginLeft</em> and <em>settings.marginTop</em>. For example, the CSS for the content wrapper is set like that:</p>

<pre>function showContent(elts, settings, callback) {
  elts.contentWrapper
    .css({ // Reset the CSS at the start position
      marginTop: (-100/2 + settings.marginScrollTop)+'px',
      marginLeft: (-100/2 + settings.marginScrollLeft)+'px',
      height: '100px',
      width: '100px',
      opacity: 0
    })
    .show()
    .animate({ // Set the width
      width: settings.width+'px',
      marginLeft: (settings.marginLeft)+'px',
      opacity: 0.5
    }, {duration: 350})
    .animate({ // Set the height
      height: settings.height+'px',
      marginTop: (settings.marginTop)+'px',
      opacity: 1
    }, {complete: callback, duration: 350});
}</pre>

<h4>Modal Dimensions</h4>

<p>Because understand how the modal is resized could be a nightmare, here is the explanation about how works nyroModal.</p>

<p>Firstly, there is <em>minWidth</em> and <em>minHeight</em> which will apply everytime regardless the modal content type. By default, these values are set to 150 by 150.</p>

<p>Then the modal window will never goes outside the viewport. If a dimension will be outside, it's decreased to fit with the view port.
  <br />There is a <em>padding</em> parameter (20 by default) used to space the external boundary of the modal from the viewport. </p>

<p>Regarding the images, they will be resized proportionnaly if they are to big to respect the <em>padding</em> described below. </p>

<p>When you make an Ajax Request, you'll show HTML content. In nyroModal, the size requested will be the real content size available inside the #nyroModalContent div. That mean the content inside the padding of the #nyroModalContent div will be the requested dimensions. For example, requested a 500 by 500 pixels size will result for the #nyroModalContent of these values (screenshot made with <a href="http://www.getfirebug.com/">Firebug</a>):

  <br /><img alt="nyroModal Dimensions" src="http://nyromodal.nyrodev.com/img/dimensions.gif" /></p>

<p>Why do that?
  <br />Imagine working on a website using nyroModal. When requested your modal with different size, you'll take care of the content to fit exactly with the design. That works and everybody is happy.

  <br />But 3 months later the design has to be changed regarding the nyroModal looks and feel for adding some margin or border.

  <br />As the dimensions is the content inside the modal, changing the dimensions of the margin, padding or border of the wrapper or content won't change the shown dimensions. To make the change you only have to change your CSS and check for some modal if it's work as expected. </p>
